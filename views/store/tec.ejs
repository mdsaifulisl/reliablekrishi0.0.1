<%- include("../partials/head.ejs") %>
<link rel="stylesheet" href="/css/tec.css">
</head>
<body>
  <!-- Header -->
   <%- include("../partials/header.ejs") %>

    <!-- All Top Heading  -->
  <div class="all-headings mb-4">
    <h1 >‡¶ï‡ßÉ‡¶∑‡¶ø ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø</h1>
    <div class="search mt-3">
      <input id="blogSearch" type="search" placeholder="‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®..." id="search-input">
      <div class="search_btn">
        <button id="searchButton" type="button"><i class="fa-solid fa-magnifying-glass"></i></button>
      </div>
    </div>
  </div>
  <!-- All Top Heading  end-->


  <section class="blog pb-5 mt-4">
    <div class="container">
      <div class="technology-heading d-flex flex-column  gap-2 mb-lg-3 mb-md-3">
        <% if(isLoggedIn) { %>
          <div class="technology-btn mb-4">
            <a class="add_btn" href="/add-blog"> + Add new Technology</a>
          </div>
        <% } %>

        <h2>‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø</h2>
      </div>

      <div class="row g-3 mt-2 blog-list-container">


        <% if (technology.length > 0) { %>
          <% technology.forEach(function(tec) { %>


            <div class="col-lg-4 col-md-6 col-sm-6 col-12 disease-item blog-item">
              <div class="disease-item-inner">
                <div class="disease-item-img">
                  <img src="<%= tec.image %>" alt="">
                </div>
                <div class="disease-item-content d-flex flex-column gap-2 mt-3">
                  <h3><%= tec.title %></h3>
                  <div class="disease-text"><%- tec.description %></div>
                  <div class="mt-3"><a href="/technology/<%= tec.id %>" class="button-earth">‡¶¨‡¶ø‡¶∏‡ßç‡¶§‡¶æ‡¶∞‡¶ø‡¶§</a></div>

                  <% if (isLoggedIn){%>
                    <div class="blog-btns blog-btns-2">

                      <div>
                        <a href="/blog/edit/<%= tec.id %>" class="edit"><i class="fa-solid fa-pen-to-square"> </i> Edit</a>
                      </div>
 
                      <form action="/blog/delete/<%= tec.id %>" method="POST" style="display:inline;" onsubmit="return confirm('Are you sure you want to delete this?');">
                        <button type="submit" class="delete"><i class="fa-solid fa-trash"></i> Delete</button>
                      </form> 
                    </div>
                  <%}%> 

                </div>
              </div>
            </div>
          <% });%>
        <% } else { %>
          <h6>‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‡¶∏‡¶Æ‡ßç‡¶™‡¶∞‡ßç‡¶ï‡ßá ‡¶ï‡¶ø‡¶õ‡ßÅ ‡¶Ø‡ßã‡¶ó‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡¶®‡¶ø</h6>
        <% } %>

        
        
      </div>

      <p id="noResultMessage" class="text-center text-danger mt-3" style="display: none;"></p>
    </div>
  </section>

  
  <!--Footer-->
   <%- include("../partials/footer.ejs") %>
  <!-- JS -->
 <script src="/js/header.js"></script>

  <script>
    const searchInput = document.getElementById('blogSearch');
    const blogItems = document.querySelectorAll('.blog-item');
    const blogContainer = document.querySelector('.blog-list-container');
    const noResultMessage = document.getElementById('noResultMessage');
    const searchButton = document.getElementById('searchButton');
    
    searchInput.addEventListener('input', () => {
      const searchValue = searchInput.value.trim().toLowerCase();
      let matchedCount = 0;

      blogItems.forEach(item => {
        const title = item.querySelector('h3')?.textContent.toLowerCase() || '';
        const content = item.querySelector('p')?.textContent.toLowerCase() || '';

        if (title.includes(searchValue) || content.includes(searchValue)) {
          item.style.display = '';
          matchedCount++;
        } else {
          item.style.display = 'none';
        }
      });

      if (matchedCount === 0) {
        noResultMessage.textContent = 'üîç ‡¶ï‡ßã‡¶®‡ßã ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‡¶™‡¶æ‡¶ì‡ßü‡¶æ ‡¶Ø‡¶æ‡ßü‡¶®‡¶ø, ‡¶®‡¶ø‡¶ö‡ßá ‡¶∏‡¶¨ ‡¶ó‡ßÅ‡¶≤‡ßã ‡¶™‡ßç‡¶∞‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§‡¶ø ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®';
        noResultMessage.style.display = 'block';

        // Show all again after short delay
        setTimeout(() => {
          blogItems.forEach(item => item.style.display = '');
          noResultMessage.style.display = 'none';
        }, 2500);
      } else {
        noResultMessage.style.display = 'none';
      }
    });

    const containers = document.querySelectorAll('.disease-text');

    containers.forEach(container => {
      const maxLength = 100;
      let totalText = '';
      const paragraphs = Array.from(container.querySelectorAll('p'));

      paragraphs.forEach(p => totalText += p.textContent.trim() + ' ');

      let truncatedText = totalText.trim().substring(0, maxLength) + '...';

      container.innerHTML = '';

      let remaining = truncatedText;
      paragraphs.forEach(p => {
        if (remaining.length <= 0) return;
        const pText = p.textContent.trim();
        let textToUse = remaining.length >= pText.length ? pText : remaining;

        if(textToUse.trim() !== '') {
          const newP = document.createElement('p');
          newP.textContent = textToUse;
          container.appendChild(newP);
        }

        remaining = remaining.slice(textToUse.length).trim();
      });
    });
  </script>
</body> 
</html>